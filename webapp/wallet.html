<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CÃ¼zdan</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0b1220;color:#e8eefc}
    .card{margin:16px;padding:16px;border-radius:16px;background:#111c33;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .row{display:flex;justify-content:space-between;gap:12px;margin-top:12px}
    .pill{padding:12px 14px;border-radius:14px;background:#0b152b;flex:1}
    .label{color:#9aa7c2;font-size:12px}
    .val{font-size:22px;font-weight:700;margin-top:6px}
    .btn{margin-top:14px;width:100%;padding:12px;border:0;border-radius:14px;background:#2b6fff;color:white;font-weight:700}
    .muted{color:#9aa7c2;font-size:13px;margin-top:10px;line-height:1.4}
  </style>
</head>
<body>
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-size:18px;font-weight:800">ðŸ‘› CÃ¼zdan</div>
      <div id="state" class="label">yÃ¼kleniyorâ€¦</div>
    </div>

    <div class="row">
      <div class="pill">
        <div class="label">TL</div>
        <div id="tl" class="val">0.00 â‚º</div>
      </div>
      <div class="pill">
        <div class="label">Elmas</div>
        <div id="dia" class="val">0.00 ðŸ’Ž</div>
      </div>
    </div>

    <div class="muted">
      Bu sayfa WebApp olarak aÃ§Ä±lÄ±r. Bakiyeler Supabase'ten okunur.
    </div>

    <button class="btn" id="close">Kapat</button>
  </div>

<script>
  const tg = window.Telegram?.WebApp;
  if (tg) { tg.ready(); tg.expand(); }

  function getTgId(){
    const p=new URLSearchParams(location.search);
    const q=p.get('tg_id');
    if(q && /^[0-9]+$/.test(q)) return Number(q);
    return tg?.initDataUnsafe?.user?.id || null;
  }
  const tgId=getTgId();

  async function load(){
    const state=document.getElementById('state');
    if(!tgId){ state.textContent='tg_id yok'; return; }
    try{
      const r=await fetch('/api/wallet',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({tg_id:tgId})});
      const d=await r.json();
      if(!d.ok){ state.textContent='hata'; return; }
      document.getElementById('tl').textContent=(Number(d.tl||0).toFixed(2))+' â‚º';
      document.getElementById('dia').textContent=(Number(d.diamonds||0).toFixed(2))+' ðŸ’Ž';
      state.textContent='hazÄ±r';
    }catch(e){
      state.textContent='hata';
    }
  }
  document.getElementById('close').onclick=()=>tg?.close();
  load();
</script>
</body>
</html>