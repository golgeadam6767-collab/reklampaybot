<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Para Ã‡ek</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{--bg:#0b1220;--card:#0f1a33;--text:#e6eefc;--muted:#9fb3d8;--border:#223055;}
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}
    body{margin:0;background:linear-gradient(180deg,#071022,#0b1220);color:var(--text);min-height:100vh;padding:16px;}
    .card{max-width:560px;margin:0 auto;background:rgba(15,26,51,.92);border:1px solid var(--border);border-radius:18px;box-shadow:0 12px 32px rgba(0,0,0,.35);overflow:hidden;padding:16px;}
    h1{margin:0 0 6px;font-size:18px}
    .sub{color:var(--muted);font-size:13px;margin-bottom:14px}
    label{display:block;font-size:12px;color:var(--muted);margin-top:10px;margin-bottom:6px}
    input{width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);background:#0a1123;color:var(--text);outline:none}
    .btn{width:100%;margin-top:14px;padding:14px;border-radius:14px;border:0;font-weight:800;font-size:16px;background:#e8eefc;color:#111;cursor:pointer}
    .msg{margin-top:10px;padding:10px 12px;border-radius:14px;display:none}
    .ok{background:rgba(52,199,89,.10);border:1px solid rgba(52,199,89,.35);color:#d6ffdd}
    .err{background:rgba(255,59,48,.08);border:1px solid rgba(255,59,48,.35);color:#ffd2d2}
  </style>
</head>
<body>
  <div class="card">
    <h1>ðŸ’¸ Para Ã‡ek</h1>
    <div class="sub">Bu ekran sadece talep oluÅŸturur. Ã–deme manuel onaylanÄ±r.</div>

    <label>Tutar (TL)</label>
    <input id="amt" type="number" min="0" step="0.01" placeholder="Ã–rn: 50" />

    <label>IBAN</label>
    <input id="iban" placeholder="TR..." />

    <button id="go" class="btn">Talep OluÅŸtur</button>
    <button id="close" class="btn" style="margin-top:10px;background:#1a2b55;color:#e6eefc;border:1px solid var(--border)">Kapat</button>

    <div id="msg" class="msg"></div>
  </div>

<script>
(function(){
  const tg = window.Telegram?.WebApp;
  if (tg) { tg.expand(); tg.ready(); }
  const initData = tg ? tg.initData : "";

  const msg = document.getElementById("msg");
  function show(type, text){
    msg.style.display="block";
    msg.className = "msg " + (type==="ok" ? "ok" : "err");
    msg.textContent = text;
  }

  async function api(path, body){
    const r = await fetch(path, {
      method:"POST",
      headers: { "Content-Type":"application/json", "X-Telegram-InitData": initData },
      body: JSON.stringify(body || {})
    });
    const j = await r.json().catch(()=>({ok:false,error:"bad_json"}));
    if(!r.ok || !j.ok) throw new Error(j.error || ("http_"+r.status));
    return j;
  }

  document.getElementById("close").onclick = ()=>{ if(tg) tg.close(); else window.close(); };

  document.getElementById("go").onclick = async ()=>{
    try{
      const amt = Number(document.getElementById("amt").value || 0);
      const iban = document.getElementById("iban").value || "";
      const j = await api("/api/withdraw", { amount_tl: amt, iban });
      show("ok", `âœ… Talep alÄ±ndÄ±. Kalan TL: ${Number(j.balance_tl).toFixed(2)} â‚º`);
    }catch(e){
      show("err", "Hata: " + e.message);
    }
  };
})();
</script>
</body>
</html>
